<!DOCTYPE html>
<html>
<head>
  <title>Pressure Quadrants</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: sans-serif;
    }

    #grid {
      display: grid;
      grid-template-columns: 150px 150px;
      grid-template-rows: 150px 150px;
      gap: 10px;
      margin-top: 30px;
    }

    .quadrant {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
      font-weight: bold;
      background-color: #ccc;
      border-radius: 10px;
      transition: background-color 0.3s;
    }

    .flash {
      animation: flash 0.6s infinite alternate;
    }

    @keyframes flash {
      0% { background-color: red; }
      100% { background-color: #ff8080; }
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Force Sensor Visualization</h1>
  <button onclick="connect()">Connect to Puck.js</button>

  <div id="grid">
    <div class="quadrant" id="q0">0.00</div>
    <div class="quadrant" id="q1">0.00</div>
    <div class="quadrant" id="q2">0.00</div>
    <div class="quadrant" id="q3">0.00</div>
  </div>

  <script>
    function setQuadrantColor(el, value) {
      el.classList.remove("flash");

      if (value <= 0.3) {
        el.style.backgroundColor = "green";
      } else if (value <= 0.7) {
        el.style.backgroundColor = "yellow";
      } else if (value <= 0.9) {
        el.style.backgroundColor = "red";
      } else {
        el.classList.add("flash");
      }
    }

    function handleNotification(event) {
      const value = new TextDecoder().decode(event.target.value);
      const readings = value.split(',').map(parseFloat);
      readings.forEach((val, idx) => {
        const el = document.getElementById("q" + idx);
        el.textContent = val.toFixed(2);
        setQuadrantColor(el, val);
      });
    }

    async function connect() {
      try {
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ services: ['battery_service'] }]
        });

        const server = await device.gatt.connect();
        const service = await server.getPrimaryService('battery_service');
        const characteristic = await service.getCharacteristic('2a19');

        await characteristic.startNotifications();
        characteristic.addEventListener('characteristicvaluechanged', handleNotification);

        alert("Connected to Puck.js and receiving data!");
      } catch (err) {
        alert("Failed to connect: " + err.message);
        console.error(err);
      }
    }
  </script>
</body>
</html>
